# .github/workflows/deploy.yml
name: Deploy new site to org Pages

on:
  push:
    branches: [ deploy ]   # ä¾ä½ çš„é è¨­åˆ†æ”¯èª¿æ•´

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 22.12.0

      - name: Install dependencies
        run: npm ci

      - name: Build site
        run: npm run build   # ä¾ä½ çš„å°ˆæ¡ˆèª¿æ•´æ‰“åŒ…æŒ‡ä»¤

      # ğŸ”¥ é—œéµï¼šç‚º SPA å»ºç«‹ 404.htmlï¼Œè®“ GitHub Pages 404 ä¹Ÿå›åˆ°ä½ çš„ React/Vite App
      - name: Create 404.html for SPA routing
        run: cp dist/index.html dist/404.html

      - name: Deploy to Sociolegal-Lab.github.io
        uses: peaceiris/actions-gh-pages@v4
        with:
          external_repository: Sociolegal-Lab/Sociolegal-Lab.github.io
          publish_dir: ./dist            # ä½ çš„æ‰“åŒ…è¼¸å‡ºè³‡æ–™å¤¾
          publish_branch: main           # ç›®æ¨™ repo çš„ç™¼ä½ˆåˆ†æ”¯
          deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }}
